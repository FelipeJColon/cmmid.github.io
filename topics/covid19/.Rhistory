group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant)
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot))) %>%
filter(abundant == "abundant",
inc > 150)
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot))) %>%
# filter(abundant == "abundant",
#        inc > 150)
ggplot(., aes(x = date,
y = inc,
group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant)
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot))) %>%
# filter(abundant == "abundant",
#        inc > 150)
ggplot(., aes(x = date,
y = inc,
group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant) +
labs(y = "Daily Incidence",
x = "Date")
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot)),
abundant = factor(abundant,
labels = c(">= 30 Hospitals",
"< 30 hospitals"))) %>%
# filter(abundant == "abundant",
#        inc > 150)
ggplot(., aes(x = date,
y = inc,
group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant) +
labs(y = "Daily Incidence",
x = "Date")
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot)),
abundant = factor(abundant,
levels = c("poor", "abundant"),
labels = c(">= 30 Hospitals",
"< 30 hospitals"))) %>%
# filter(abundant == "abundant",
#        inc > 150)
ggplot(., aes(x = date,
y = inc,
group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant) +
labs(y = "Daily Incidence",
x = "Date")
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot)),
abundant = factor(abundant,
levels = c("poor", "abundant"),
labels = c("< 30 Hospitals",
">= 30 hospitals"))) %>%
# filter(abundant == "abundant",
#        inc > 150)
ggplot(., aes(x = date,
y = inc,
group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant) +
labs(y = "Daily Incidence",
x = "Date")
3/13
cases %>%
filter(CNTY_CODE != "420100",
date <= "2020-03-01") %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(CNTY_CODE) %>%
mutate(phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY",
"Post-LNY")),
inc = c(NA, diff(cases_tot)),
abundant = factor(abundant,
levels = c("poor", "abundant"),
labels = c("< 30 Hospitals",
">= 30 hospitals"))) %>%
# filter(abundant == "abundant",
#        inc > 150)
ggplot(., aes(x = date,
y = inc,
group = CNTY_CODE))+
geom_point(alpha = 0.5) +
geom_line(alpha = 0.5) +
theme_bw() +
scale_fill_viridis() +
facet_wrap(~abundant) +
labs(y = "Daily Incidence",
x = "Date") -> p_cases
library(ggpubr)
ggarrange(p_cases, p_hosp)
all_history %>%
mutate(date_diff = date - as.Date("2020-01-01") + 1,
date = as.Date(date, origin = "1960-10-01"),
value = as.numeric(value),
wk = ceiling(date_diff/7) %>% as.integer()) %>%
group_by(CNTY_CODE, wk, type) %>%
#summarise(flux = sum(value))%>%
pivot_wider(names_from = type,
values_from = value) %>%
ungroup %>%
mutate(flux_diff = history_in - history_out,
date_diff = as.numeric(date_diff),
date = as.character(date),
phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY", "Post-LNY"))) %>%
#wk = factor(wk, levels = 1:9),
#order = T) %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
filter(date <= "2020-03-01",
wk < 10) %>%
mutate(wk = factor(wk, levels = 1:9)) %>%
ggplot(., aes(x = hosp_no,
y = flux_diff,
#color = phase,
group = date))+
geom_point(alpha = 0.2) +
# geom_line(alpha = 0) +
stat_smooth(geom = "line",
aes(group = phase,
color = phase),
alpha = 0.5,
size = 1,
method = "lm",
se = T)+
scale_color_viridis(discrete = T) +
# scale_color_viridis(breaks = seq(1,61,20),
#                     labels = date_labels[seq(1,61,20)]) +
theme_bw() +
facet_wrap(~phase) +
geom_hline(yintercept = 0) +
labs(x = "Number of Hospitals",
y = "Net Traveller Change") +
scale_x_log10() +
geom_vline(xintercept = 30)+
#guides(colour = guide_legend(override.aes = list(alpha=1)))
-> p_hosp
p_hosp
all_history %>%
mutate(date_diff = date - as.Date("2020-01-01") + 1,
date = as.Date(date, origin = "1960-10-01"),
value = as.numeric(value),
wk = ceiling(date_diff/7) %>% as.integer()) %>%
group_by(CNTY_CODE, wk, type) %>%
#summarise(flux = sum(value))%>%
pivot_wider(names_from = type,
values_from = value) %>%
ungroup %>%
mutate(flux_diff = history_in - history_out,
date_diff = as.numeric(date_diff),
date = as.character(date),
phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY", "Post-LNY"))) %>%
#wk = factor(wk, levels = 1:9),
#order = T) %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
filter(date <= "2020-03-01",
wk < 10) %>%
mutate(wk = factor(wk, levels = 1:9)) %>%
ggplot(., aes(x = hosp_no,
y = flux_diff,
#color = phase,
group = date))+
geom_point(alpha = 0.2) +
# geom_line(alpha = 0) +
stat_smooth(geom = "line",
aes(group = phase,
color = phase),
alpha = 0.5,
size = 1,
method = "lm",
se = T)+
scale_color_viridis(discrete = T) +
# scale_color_viridis(breaks = seq(1,61,20),
#                     labels = date_labels[seq(1,61,20)]) +
theme_bw() +
facet_wrap(~phase) +
geom_hline(yintercept = 0) +
labs(x = "Number of Hospitals",
y = "Net Traveller Change") +
scale_x_log10() +
geom_vline(xintercept = 30)
all_history %>%
mutate(date_diff = date - as.Date("2020-01-01") + 1,
date = as.Date(date, origin = "1960-10-01"),
value = as.numeric(value),
wk = ceiling(date_diff/7) %>% as.integer()) %>%
group_by(CNTY_CODE, wk, type) %>%
#summarise(flux = sum(value))%>%
pivot_wider(names_from = type,
values_from = value) %>%
ungroup %>%
mutate(flux_diff = history_in - history_out,
date_diff = as.numeric(date_diff),
date = as.character(date),
phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY", "Post-LNY"))) %>%
#wk = factor(wk, levels = 1:9),
#order = T) %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
filter(date <= "2020-03-01",
wk < 10) %>%
mutate(wk = factor(wk, levels = 1:9)) %>%
ggplot(., aes(x = hosp_no,
y = flux_diff,
#color = phase,
group = date))+
geom_point(alpha = 0.2) +
# geom_line(alpha = 0) +
# stat_smooth(geom = "line",
#             aes(group = phase,
#                 color = phase),
#             alpha = 0.5,
#             size = 1,
#             method = "lm",
#             se = T)+
# scale_color_viridis(discrete = T) +
# scale_color_viridis(breaks = seq(1,61,20),
#                     labels = date_labels[seq(1,61,20)]) +
theme_bw() +
facet_wrap(~phase) +
geom_hline(yintercept = 0) +
labs(x = "Number of Hospitals",
y = "Net Traveller Change") +
scale_x_log10() +
geom_vline(xintercept = 30)
#color = phase))+
ggplot(., aes(x = hosp_no,
phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
all_history %>%
mutate(date_diff = date - as.Date("2020-01-01") + 1,
date = as.Date(date, origin = "1960-10-01"),
value = as.numeric(value),
wk = ceiling(date_diff/7) %>% as.integer()) %>%
group_by(CNTY_CODE, wk, type) %>%
#summarise(flux = sum(value))%>%
pivot_wider(names_from = type,
values_from = value) %>%
ungroup %>%
mutate(flux_diff = history_in - history_out,
date_diff = as.numeric(date_diff),
date = as.character(date),
phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY", "Post-LNY"))) %>%
#wk = factor(wk, levels = 1:9),
#order = T) %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
filter(date <= "2020-03-01",
wk < 10) %>%
mutate(wk = factor(wk, levels = 1:9)) %>%
ggplot(., aes(x = hosp_no,
y = flux_diff)) +
#color = phase))+
geom_point(alpha = 0.2) +
# geom_line(alpha = 0) +
# stat_smooth(geom = "line",
#             aes(group = phase,
#                 color = phase),
#             alpha = 0.5,
#             size = 1,
#             method = "lm",
#             se = T)+
# scale_color_viridis(discrete = T) +
# scale_color_viridis(breaks = seq(1,61,20),
#                     labels = date_labels[seq(1,61,20)]) +
theme_bw() +
facet_wrap(~phase) +
geom_hline(yintercept = 0) +
labs(x = "Number of Hospitals",
y = "Net Traveller Change") +
scale_x_log10() +
geom_vline(xintercept = 30)
all_history %>%
mutate(date_diff = date - as.Date("2020-01-01") + 1,
date = as.Date(date, origin = "1960-10-01"),
value = as.numeric(value),
wk = ceiling(date_diff/7) %>% as.integer()) %>%
group_by(CNTY_CODE, wk, type) %>%
#summarise(flux = sum(value))%>%
pivot_wider(names_from = type,
values_from = value) %>%
ungroup %>%
mutate(flux_diff = history_in - history_out,
date_diff = as.numeric(date_diff),
date = as.character(date),
phase = if_else(date <= "2020-01-25", "Pre-LNY", "Post-LNY"),
phase = factor(phase, levels = c("Pre-LNY", "Post-LNY"))) %>%
#wk = factor(wk, levels = 1:9),
#order = T) %>%
left_join(hosp_cts, by = "CNTY_CODE") %>%
filter(date <= "2020-03-01",
wk < 10) %>%
mutate(wk = factor(wk, levels = 1:9)) %>%
ggplot(., aes(x = hosp_no,
y = flux_diff)) +
#color = phase))+
geom_point(alpha = 0.2) +
# geom_line(alpha = 0) +
# stat_smooth(geom = "line",
#             aes(group = phase,
#                 color = phase),
#             alpha = 0.5,
#             size = 1,
#             method = "lm",
#             se = T)+
# scale_color_viridis(discrete = T) +
# scale_color_viridis(breaks = seq(1,61,20),
#                     labels = date_labels[seq(1,61,20)]) +
theme_bw() +
facet_wrap(~phase) +
geom_hline(yintercept = 0) +
labs(x = "Number of Hospitals",
y = "Net Traveller Change") +
scale_x_log10() +
geom_vline(xintercept = 30)-> p_hosp
ggarrange(p_cases,
p_hosp,
ncol = 1)
ggsave(filename = paste0(gibbs_path_win,"Yang/cases_hosp.png"),
width = 10,
height = 10,
dpi = 800)
ggarrange(p_hosp,
p_cases,
ncol = 1)
ggsave(filename = paste0(gibbs_path_win,"Yang/cases_hosp.png"),
width = 10,
height = 10,
dpi = 800)
pop
pop %>%
right_join(hosp_cts, by = "CNTY_CODE")
pop %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(abundant) %>%
summarise(n  = sum(hosp_no))
2071/(2071+3400)
pop %>%
right_join(hosp_cts, by = "CNTY_CODE") #%>%
pop %>%
mutate(nt = ntile(pop_tot, 4))
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") #%>%
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no))
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no)) %>%
mutate(x = sum(n))
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no),
pop = mean(pop_tot)) %>%
mutate(x = sum(n))
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no),
pop = sum(pop_tot)) %>%
mutate(x = sum(n))
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no),
pop = sum(pop_tot)) %>%
mutate(x = sum(n),
pop_tot = sum(pop, na.rm = T))
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no),
pop = sum(pop_tot)) %>%
mutate(x = sum(n),
pop_tot = sum(pop, na.rm = T),
r1 = pop/pop_tot)
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no),
pop = sum(pop_tot)) %>%
mutate(x = sum(n),
pop_tot = sum(pop, na.rm = T),
r1 = pop/pop_tot,
r2 = n/x)
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
summarise(n = sum(hosp_no),
pop = sum(pop_tot),
hosp = sum(hosp_no)) %>%
mutate(x = sum(n),
pop_tot = sum(pop, na.rm = T),
r1 = pop/pop_tot,
r2 = n/x)
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
filter(nt == 1)
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
filter(nt == 1) %>%
pull(hosp_no)
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
filter(nt == 1) %>%
pull(hosp_no) %>%
hist()
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
filter(nt == 1) %>%
pull(hosp_no) %>%
summary
pop %>%
mutate(nt = ntile(pop_tot, 4)) %>%
right_join(hosp_cts, by = "CNTY_CODE") %>%
group_by(nt) %>%
filter(nt == 1) %>%
pull(hosp_no) %>%
table
366*366*61
load("C:/Users/eideyliu/Downloads/contacts.Rdata")
View(contacts)
load("C:/Users/eideyliu/Downloads/contacts_china.rdata")
setwd("~/GitHub/cmmid.github.io/topics/covid19")
