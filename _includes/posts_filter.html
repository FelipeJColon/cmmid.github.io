<div class="filter">
  <div class="top">
    <div class="row">
      <div class="col-xs-6">
        {% include fn_gettranslation string="Posts" lang=page.language %}
      </div>
      <div class="col-xs-6">
        <button data-toggle="collapse" data-target="#filter-options"><span class="filter-icon" title="Filter posts"></span></button>
      </div>
    </div>
  </div>
  <div id="filter-options" class="bottom collapse">
    <div class="wrapper">
      {% assign statusses = 'in-progress' | split: '*' %}

      {% for post in posts %}
        {% unless statusses contains post.status %}
          {% if post.status %}
            {% assign translated_status = include fn_gettranslation string=post.status lang=page.language %}
            {% assign statusses = statusses | push: post.status %}
          {% endif %}
        {% endunless %}
      {% endfor %}
      {% unless statusses.size == 0 %}
        <p>{% include fn_gettranslation string="Status" lang=page.language %}:
        {% for status in statusses %}
          <label> {% include fn_gettranslation string=status lang=page.language %} <input type="checkbox" checked="checked" class="filter-select" data-filter="status" value="{{status}}"></label>
        {% endfor %}
        </p>
      {% endunless %}

      {% assign subcategories = '' | split: '' %}
      {% for post in posts %}
        {% assign use_category = false %}
        {% for post_cat in post.categories %}
          {{% post.title %}}
          {% unless use_category == false or subcategories contains post_cat %}
            {% assign subcategories = subcategories | push: post_cat %}
          {% endunless %}
          {% if post_cat == page.category_filter %}
            {% assign use_category = true %}
          {% endif %}
        {% endfor %}
      {% endfor %}
      {% unless subcategories.size == 0 %}
        <p>{% include fn_gettranslation string="Category" lang=page.language %}:
        {% for cat in subcategories %}
          <label> {% include fn_getcatname cat=cat lang=page.language %} <input type="checkbox" checked="checked" class="filter-select" data-filter="category" value="{{cat}}"></label>
        {% endfor %}
        </p>
      {% endunless %}
    </div>
  </div>
</div>


<script>
	$('.filter-select').click(
		function(){
			//make all visible
			$('.posts article').css("display", "");

			//get unchecked boxes
			var checked_classes = [];
			$( '.filter input:not(:checked)' ).each(
				function() {
					checked_classes.push( $( this ).data("filter") +'_'+$( this ).val() );
				}
			);

			//hide those unchecked
			$.each(checked_classes, function(i, val){
				$( '.posts article.'+val ).css("display","none");
			});

			//count number of articles visible
			var count_articles = $(".posts article").not(
				$(".posts article").filter(
					function(){
						return $(this).css("display") == "none"
					}
				)
			).length;
			//show no-articles block if no articles
			if(count_articles == 0){
				$('.no-articles').css("display","block");
			} else {
				$('.no-articles').css("display","none");
			}
		}
	)
</script>
